# **Sql with python**

Что ж, с базовыми командами в нашем **SQL** мы с вами познакомились        
но думаю абсолютно логичный вопрос мог возникнуть у вас: "Эт всё хорошо,         
но работать-то как с этим делом? Отдельно от питона?" На наше счастье         
этого делать не придётся, так как в питоне есть достаточно много        
библиотек, которые позволяют нам работать с определённой базой данных        
посредством питона.

# **Библиотеки Python для работы с SQL базами данных**

## **Intro**

**SQL (Structured Query Language)** - это язык программирования, который         
используется для работы с реляционными базами данных. В **Python** существует       
несколько популярных библиотек, которые облегчают взаимодействие с базами       
данных, позволяя программистам выполнять **SQL-запросы** и манипулировать         
данными. В этой лекции мы рассмотрим основные библиотеки для работы       
с **SQL** базами данных в **Python**, такие как **sqlite3**, **SQLAlchemy**,       
**PyMySQL**, **psycopg2** и рассмотрим их применение в различных сценариях.        

### 1. **sqlite3**

Это встроенная библиотека **Python**, которая обеспечивает простой доступ к базе       
данных **SQLite** без необходимости установки дополнительных драйверов или       
серверов. **SQLite** предоставляет легковесный и однопользовательский       
способ управления базами данных, что делает его отличным выбором для      
небольших проектов или прототипов.

#### **Применение:**

* Простые проекты или прототипы, не требующие множественных подключений к базе данных.


* Локальное хранение данных в однопользовательском режиме.


* Использование в тестировании и разработке.


#### **Пример создания подключения:**

```python
import sqlite3

# Создание или подключение к базе данных SQLite
conn = sqlite3.connect('example.db')

# Создание курсора для выполнения SQL-запросов
cursor = conn.cursor()

# Пример выполнения SQL-запроса
cursor.execute("CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, name TEXT, age INTEGER)")

# Сохранение изменений в базе данных
conn.commit()

# Закрытие подключения
conn.close()
```

---

### 2. **SQLAlchemy**

Это мощный **ORM (Object-Relational Mapping)** инструмент, который позволяет        
разработчикам работать с различными **СУБД**, такими как **SQLite**, **PostgreSQL**,    
**MySQL** и другими, используя единый интерфейс. Он предоставляет уровень        
абстракции, позволяя вам работать с базой данных через      
объекты и **SQL-выражения**.

#### **Применение:**

* Большие проекты, требующие поддержки различных СУБД без изменения кода.


* Отображение данных из базы данных на объекты Python и обратно.


* Управление сложными SQL-запросами.


#### **Пример создания подключения:**

```python
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy import Column, Integer, String
from sqlalchemy.orm import sessionmaker

# Создание или подключение к базе данных SQLite с использованием SQLAlchemy
engine = create_engine('sqlite:///example.db', echo=True)

# Пример определения класса для отображения таблицы
Base = declarative_base()
Session = sessionmaker(bind=engine)
session = Session()


class User(Base):
    __tablename__ = 'users'
    id = Column(Integer, primary_key=True)
    name = Column(String)
    age = Column(Integer)


# Создание таблицы (если ещё не существует)
Base.metadata.create_all(engine)

new_user = User(name='Vladislav', age=37)
session.add(new_user)
session.commit()
session.close()
```

---

### 3. **PyMySQL**

Это чистый **Python-клиент** для **MySQL**, который обеспечивает подключение к      
серверу **MySQL** и выполнение **SQL-запросов**. Он хорошо подходит для       
проектов, в которых требуется взаимодействие с базой данных **MySQL**.       

#### **Применение:**

* Проекты, использующие MySQL в качестве СУБД.


* Простые веб-приложения с базой данных MySQL.


#### **Пример создания подключения:**

```python
import pymysql

# Создание подключения к базе данных MySQL
conn = pymysql.connect(
    host='localhost',
    user='username',
    password='password',
    database='dbname'
)

# Создание курсора для выполнения SQL-запросов
cursor = conn.cursor()

# Пример выполнения SQL-запроса
cursor.execute("""
    CREATE TABLE IF NOT EXISTS users (
        id INT PRIMARY KEY AUTO_INCREMENT,
        name VARCHAR(255),
        age INT
        )
""")

# Сохранение изменений в базе данных
conn.commit()

# Закрытие подключения
conn.close()
```

---

### 4. **psycopg2**

Это адаптер баз данных **PostgreSQL** для **Python**. Он позволяет       
взаимодействовать с базой данных **PostgreSQL** и выполнять **SQL-запросы**.

#### **Применение:**

* Проекты, использующие PostgreSQL в качестве СУБД.


* Приложения, работающие с большим объемом данных.


#### **Пример создания подключения:**

```python
import psycopg2

# Создание подключения к базе данных PostgreSQL
conn = psycopg2.connect(
    host="localhost",
    database="dbname",
    user="username",
    password="password"
)

# Создание курсора для выполнения SQL-запросов
cursor = conn.cursor()

# Пример выполнения SQL-запроса
cursor.execute("""
    CREATE TABLE IF NOT EXISTS users (
        id SERIAL PRIMARY KEY,
        name VARCHAR(255),
        age INT
    )
""")

# Сохранение изменений в базе данных
conn.commit()

# Закрытие подключения
conn.close()
```

### **Пример запроса на python**

```python
import sqlite3

# Создание или подключение к базе данных SQLite
conn = sqlite3.connect('example.db')

# Создание курсора для выполнения SQL-запросов
cursor = conn.cursor()

# Выполнение INSERT-запроса
cursor.execute("INSERT INTO users (name, age) VALUES (?, ?)", ('John Doe', 30))

# Выполнение UPDATE-запроса
cursor.execute("UPDATE users SET age = ? WHERE id = ?", (35, 1))

# Выполнение DELETE-запроса
cursor.execute("DELETE FROM users WHERE id = ?", (2,))

# Сохранение изменений в базе данных
conn.commit()

# Закрытие курсора
cursor.close()

# Закрытие подключения
conn.close()
```

---

Запросы типа **SELECT** возвращают результаты, которые можно получить    
с помощью методов **fetchone()** (возвращает одну строку), **fetchall()**        
(возвращает все строки) или **fetchmany(n)** (возвращает n строк).         
Запросы типа **INSERT**, **UPDATE** и **DELETE** обычно не возвращают результаты.


**SELECT через python:**

```python
import sqlite3

# Создание или подключение к базе данных SQLite
# Создание курсора для выполнения SQL-запросов

# Выполнение SELECT-запроса
cursor.execute("SELECT * FROM users")

# Получение результатов запроса
rows = cursor.fetchall()

# Вывод результатов
for row in rows:
    print(row)

# Закрытие курсора
cursor.close()

# Закрытие подключения
conn.close()
```

---

# **Описание sqlite3 и его применение для простых проектов**

**sqlite3** - это встроенная в **Python** библиотека, которая обеспечивает простой доступ       
к базе данных **SQLite**. **SQLite** является легковесной и самодостаточной СУБД,       
которая хранит всю базу данных в одном файле. Из-за своей простоты и        
портативности, **SQLite** широко используется для небольших и простых проектов,         
прототипов и мобильных приложений.


### **Преимущества использования sqlite3:**

* Не требует дополнительных настроек или серверов для работы.


* Поддерживает стандартный SQL и транзакции.


* Легко интегрируется с Python и другими языками программирования.


### **Создание базы данных и таблиц**

Сперва нам нужно создать базу данных и таблицы в ней: 

```python
import sqlite3

# Создание или подключение к базе данных SQLite
conn = sqlite3.connect('example.db')

# Создание курсора для выполнения SQL-запросов
cursor = conn.cursor()

# Создание таблицы users
cursor.execute("""
    CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY,
        name TEXT,
        age INTEGER
    )
""")

# Сохранение изменений в базе данных
conn.commit()

# Закрытие курсора
cursor.close()

# Закрытие подключения
conn.close()
```

### **Вставка данных в таблицы**

```python
# Вставка одной строки
cursor.execute("INSERT INTO users (name, age) VALUES (?, ?)", ('John Doe', 30))

# Вставка нескольких строк с помощью executemany
data = [
    ('Alice', 25),
    ('Bob', 28),
    ('Eve', 22)
]
cursor.executemany("INSERT INTO users (name, age) VALUES (?, ?)", data)

conn.commit()

cursor.close()
conn.close()
```

### **Чтение данных из таблиц**

```python
# Выполнение SELECT-запроса
cursor.execute("SELECT * FROM users")

# Получение результатов запроса
rows = cursor.fetchall()

# Вывод результатов
for row in rows:
    print(row)

cursor.close()
conn.close()
```


### **Обновление и удаление данных в таблицах**

```python
# Обновление данных
cursor.execute("UPDATE users SET age = ? WHERE name = ?", (35, 'John Doe'))

# Удаление данных
cursor.execute("DELETE FROM users WHERE age < ?", (25,))

conn.commit()

cursor.close()
conn.close()
```

---

# **Особенности работы с SQLite**

## **Плюсы использования SQLite:**

1. **Легкость в использовании:** **SQLite** очень прост в настройке и не требует         
сложных конфигураций или установок серверов, что делает его идеальным       
для простых и небольших проектов.


2. **Портативность:** База данных **SQLite** хранится в одном файле, что делает      
ее легко переносимой между различными платформами и операционными системами.


3. **Надежность и отказоустойчивость:** **SQLite** предоставляет механизмы      
для обработки сбоев, и в случае, если происходит неожиданное     
завершение работы, данные обычно остаются недостроенными и не повреждаются.


4. **Отсутствие необходимости в сервере: SQLite** обрабатывает запросы      
непосредственно внутри приложения, что позволяет уменьшить   
нагрузку на сервер.


## **Минусы использования SQLite:**

1. Ограничения производительности: SQLite не подходит для проектов с высокой       
нагрузкой и множественными параллельными операциями, так как работает в       
однопользовательском режиме.


2. Ограниченная функциональность: В отличие от некоторых других СУБД,        
SQLite не поддерживает некоторые функции, такие как хранимые      
процедуры и триггеры.

3. Отсутствие удаленного доступа: SQLite не поддерживает удаленный      
доступ к базе данных, поэтому не является подходящим выбором для     
клиент-серверных приложений.


## **Поддержка типов данных:**

SQLite поддерживает следующие типы данных:

* **INTEGER:** Целое число.


* **REAL:** Число с плавающей точкой.


* **TEXT:** Текстовая строка.


* **BLOB:** Двоичные данные.


* **NULL:** Пустое значение.


* **NUMERIC:** Число, представленное в формате текста.


