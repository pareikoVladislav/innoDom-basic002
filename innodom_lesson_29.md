# **Docker**

## **Makefile**

```makefile
install:
	pip install -r requirements.txt
migrations:
	python manage.py makemigrations
migrate:
	python manage.py migrate
run:
	python manage.py runserver 8010
```

## **Контейнеризация приложений**

**Контейнеризация** - это технология виртуализации на уровне          
операционной системы, которая позволяет упаковать приложение и все        
его зависимости в контейнер, обеспечивая единое и изолированное        
окружение для запуска приложения на различных системах без изменения         
кода.

---

## **Преимущества контейнеризации**

1) **Переносимость**. Контейнеры обеспечивают стандартизированную          
среду исполнения приложения, что делает их переносимыми между       
различными хостами и облаками без необходимости изменения кода        
или конфигураций. Это упрощает развертывание и миграцию        
приложений.             

2) **Изоляция**. Контейнеры предоставляют высокую степень изоляции          
приложений друг от друга и от хостовой системы. Каждый контейнер       
имеет свою собственную файловую систему, сеть и процессы, что       
уменьшает риск конфликтов между приложениями и обеспечивает        
безопасность.         

3) **Масштабируемость**. Контейнеры позволяют быстро масштабировать          
приложения горизонтально, добавляя или убирая контейнеры, в        
зависимости от нагрузки. Это обеспечивает эффективное         
использование ресурсов и обеспечивает высокую доступность         
приложения.              

4) **Удобство разработки**. Контейнеры упрощают процесс разработки,
тестирования и отладки приложений, так как разработчики могут
работать в одинаковой среде, как на своем локальном компьютере, так
и на сервере.

5) **Управление зависимостями**. Контейнеры позволяют управлять          
версиями зависимостей и библиотек приложения, что упрощает          
развертывание и обновление.          

6) **Эффективное использование ресурсов**. Контейнеры используют            
общую ядро хостовой операционной системы, что позволяет экономить            
ресурсы и повышает производительность.          

7) **Скорость запуска**. Контейнеры обеспечивают быстрый запуск          
приложения, поскольку они не требуют полной виртуализации         
операционной системы            

---

## **Основные понятия Docker**

**Dockerfile** - это текстовый файл, который содержит набор инструкций            
для создания `Docker` образа. Он определяет базовый образ,           
устанавливает зависимости, копирует файлы приложения и задает          
команды для запуска приложения внутри контейнера.           


**Образ (Image) Docker** - это шаблон, на основе которого создаются           
контейнеры. Образ содержит все необходимые файлы и инструкции для        
запуска приложения. Он может включать базовый образ, зависимости,         
код приложения и другие файлы. Образы создаются из `Dockerfile`, в         
котором описываются инструкции для построения образа.          


Создание `Docker` образов - это процесс определения и настройки среды
выполнения для приложения внутри контейнера


**Контейнер** - это экземпляр образа, который содержит все необходимое         
для запуска приложения или сервиса, включая код, зависимости,         
настройки окружения и другие необходимые ресурсы. Контейнер          
работает в изолированной среде, обеспечивая портабельность и          
безопасность приложения.           

---

## **Инструкции Dockerfile**

`FROM` - определяет базовый образ, от которого будет создаваться новый           
образ.

`WORKDIR` - устанавливает рабочую директорию для команд, выполняемых           
внутри контейнера.

`COPY` - копирует файлы из локальной файловой системы внутрь контейнера.    

`RUN` - выполняет команды внутри контейнера на этапе сборки образа.          

`CMD` - определяет команду, которая будет запускаться при старте           
контейнера.

### **Для работы требуется установка docker на вашей ос**

Для разворачивания `Django-приложения` требуется создать `Dockerfile` в         
директории проекта и написать в него инструкции. Для запуска будем         
использовать `wsgi-сервер` и `gunicron` для его запуска.          

**Gunicorn (Green Unicorn)** - это сервер приложений для Python, который          
предназначен для запуска веб-приложений, созданных на основе фреймворков,         
таких как `Django`, `Flask` и других `WSGI-совместимых` приложений           

Перед запуском сервера требуется выгрузить все используемые библиотеки в
файл `requirements.txt`. Для этого в терминале пишем `pip freeze >
requirements.txt`


```dockerfile
FROM python:3.10-alpine

WORKDIR /app

COPY . /app

ADD requirements.txt /app

RUN pip install --upgrade pip

RUN pip install -r requirements.txt
```

---

## **docker-compose**

**Docker Compose** - это инструмент для определения и управления         
многоконтейнерными приложениями в `Docker`. С его помощью можно        
определить сервисы, сети, тома и другие параметры для развертывания и         
запуска связанных контейнеров с помощью единого файла конфигурации           


#### **Основные понятия**

**Services (Сервисы)** - представляют собой отдельные компоненты         
вашего многоконтейнерного приложения. Например, каждый сервис          
может представлять веб-сервер, базу данных, очередь сообщений и т.д.          
В файле `docker-compose.yml` вы определяете каждый сервис, указывая          
образ `Docker`, необходимые порты, переменные окружения и другие           
параметры            


**Networks (Сети)** - **Docker Compose** позволяет создавать             
пользовательские сети для ваших сервисов. Это позволяет               
контролировать коммуникацию между контейнерами и обеспечить             
изоляцию между сервисами.                         


**Volumes (Тома)** - **Docker Compose** предоставляет возможность          
определить тома данных для ваших контейнеров. Тома позволяют         
сохранять данные между запусками контейнеров и обеспечивают           
персистентное хранение(возможность хранить несколько версий сразу).            


**Environment Variables (Переменные окружения)** - можно задать               
переменные окружения для каждого сервиса в файле `dockercompose.yml`, что               
облегчает настройку и конфигурирование вашего приложения.


**Команды Docker CLI** - **Docker Compose** предоставляет удобный              
интерфейс командной строки, который позволяет легко управлять              
многоконтейнерным приложением. Вы можете запускать, останавливать,            
масштабировать и перезапускать все контейнеры одной командой.              


```yaml
version: '3'

services:
  postgres:
    image: postgres:14-alpine
    restart: always
    environment:
      POSTGRES_USER: ${PG_USER}
      POSTGRES_PASSWORD: ${PG_USER_PASSWORD}
      POSTGRES_DB: ${PG_DATABASE}
    ports:
      - 5448:5448

  web:
    build: .
    command: python manage.py runserver 0.0.0.0:8000
    restart: always
    depends_on:
      - postgres
    environment:
      POSTGRES_USER: ${PG_USER}
      POSTGRES_PASSWORD: ${PG_USER_PASSWORD}
      POSTGRES_DB: ${PG_DATABASE}
    ports:
      - 8000:8000
```
---
